<!doctype html>
<html lang="en">
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AmbassadorS &middot; AmbassadorS</title>
  <base href="https://jkawamoto.github.io/ambassadors/"/>

  <meta name="description" content="Yet another Ambassador pattern over SSH">
  <meta name="generator" content="Hugo 0.15" />
  <meta name="twitter:card" content="summary">
  
  <meta name="twitter:title" content="AmbassadorS &middot; AmbassadorS">
  <meta name="twitter:description" content="Yet another Ambassador pattern over SSH">

  <meta property="og:type" content="article">
  <meta property="og:title" content="AmbassadorS &middot; AmbassadorS">
  <meta property="og:description" content="Yet another Ambassador pattern over SSH">

  <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:400,700|Oxygen:400,700' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/pure-min.css">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-min.css">

  <link rel="stylesheet" href="css/all.min.css" />
  <link rel="stylesheet" href="css/custom.css" />
  <link rel="stylesheet" href="css/remodal.css" />
  <link rel="stylesheet" href="css/remodal-default-theme.css" />
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" />

  <link rel="alternate" type="application/rss+xml" title="AmbassadorS" href="https://jkawamoto.github.io/ambassadors//index.xml" />
</head>

  <body>
    <div id="layout" class="pure-g remodal-bg">
      <div class="sidebar pure-u-1 pure-u-md-1-4">
  <div class="header">
    <hgroup>
      <h1 class="brand-title"><a href="https://jkawamoto.github.io/ambassadors/">AmbassadorS</a></h1>
      <h2 class="brand-tagline"> Yet another Ambassador pattern over SSH </h2>
    </hgroup>

    <nav class="nav">
      <ul class="nav-list">
        
        
        <li class="nav-item">
          <a class="pure-button" href="https://github.com/jkawamoto/ambassadors "><i class="fa fa-github-alt"></i> github</a>
        </li>
        
        <li class="nav-item">
          <a class="pure-button" href="https://jkawamoto.github.io/ambassadors//index.xml"><i class="fa fa-rss"></i> rss</a>
        </li>
        <li class="nav-item">
          <a class="pure-button" href="#" data-remodal-target="wallet"><i class="fa fa-btc"></i> donate</a>
        </li>
      </ul>
    </nav>

  </div>
</div>

      <div class="content pure-u-1 pure-u-md-3-4">
        <div>
          
          <div class="posts">
            
            <h1 class="content-subhead">11 Aug 2016, 15:06</h1>
            <section class="post">
              <header class="post-header">
                <a href="https://jkawamoto.github.io/ambassadors/README/" class="post-title"></a>
                <p class="post-meta">
                    
                    
                </p>
              </header>
              <div class="post-description">
                

<p><a href="LICENSE"><img src="https://img.shields.io/badge/license-MIT-blue.svg?style=flat" alt="MIT License" /></a>
<a href="https://hub.docker.com/r/jkawamoto/ambassadors/"><img src="https://img.shields.io/badge/dockerhub-jkawamoto%2Fambassadors-blue.svg" alt="Dockerhub" /></a>
<a href="https://hub.docker.com/r/jkawamoto/rpi-ambassadors/"><img src="https://img.shields.io/badge/dockerhub-jkawamoto%2Frpi--ambassadors-blue.svg" alt="Dockerhub" /></a>
<a href="http://microbadger.com/images/jkawamoto/ambassadors"><img src="https://images.microbadger.com/badges/image/jkawamoto/ambassadors.svg" alt="Image information" /></a>
<a href="https://github.com/jkawamoto/ambassadors/releases/tag/v1.0.0"><img src="https://img.shields.io/badge/release-1.0.0-brightgreen.svg" alt="Release" /></a>
<a href="http://qiita.com/jkawamoto/items/4b87d0f61ab3fbbd2897"><img src="https://img.shields.io/badge/qiita-%E6%97%A5%E6%9C%AC%E8%AA%9E-brightgreen.svg" alt="Japanese" /></a></p>

<p>Yet another <a href="https://docs.docker.com/engine/admin/ambassador_pattern_linking/">Ambassador pattern</a> over SSH.</p>

<p><img src="img/secure-link.png" alt="Secure link" /></p>

<h2 id="install:04c6e90faac2675aa89e2176d2eec7d8">Install</h2>

<p>You can pull a built container.</p>

<pre><code class="language-sh">$ docker pull jkawamoto/ambassadors
</code></pre>

<p>If you are running on Raspberry Pi, you can pull it instead.</p>

<pre><code class="language-sh">$ docker pull jkawamoto/rpi-ambassadors
</code></pre>

<h2 id="usage:04c6e90faac2675aa89e2176d2eec7d8">Usage</h2>

<pre><code>$ docker run -dt jkawamoto/ambassadors (server|client|tunnel) [-v]

Options:
  -v           Verbose mode for debugging.
</code></pre>

<p>AmbassadorS has three modes; server, client, and tunnel.
Those modes are associated as follows.</p>

<pre><code>(a container) ---&gt; (AmbassadorS client) ---&gt; (AmbassadorS tunnel)
              == ssh ==&gt; (AmbassadorS server) ---&gt; (service containers)
</code></pre>

<p>You need one server-mode container on a host which has containers to be linked, i.e. <em>service containers</em>,
and one tunnel-mode container on each &ldquo;client&rdquo; host.
You also need client-mode containers for every linking container.</p>

<h2 id="example:04c6e90faac2675aa89e2176d2eec7d8">Example</h2>

<p>Suppose you have MySQL and MongoDB containers on host <em>A</em>, and a container on host <em>B</em> wants to link them,
you firstly need to run a server-mode container linking the MySQL and MongoDB containers on host <em>A</em>.</p>

<pre><code class="language-sh">$ docker run -d --name ambassadors_server \
             -v ~/.ssh/:/data/ -p 10022:22 \
             --link mongo:mongo --link mysql:mysql \
             jkawamoto/ambassadors server
</code></pre>

<p>The server-mode container requires <code>authorized_keys</code> in <code>/data/</code> and to expose port <code>22</code> for sshd.
In this example, <code>authorized_keys</code> of host <em>A</em> will be used from the server-mode container.
The server-mode container also needs to link service containers.
In this case, it links to containers named mongo and mysql.</p>

<p>On host <em>B</em>, you need to run a tunnel-mode container.</p>

<pre><code class="language-sh">$ docker run -dt --name ambassadors_tunnel \
            -v ~/.ssh:/root/.ssh -e PORT=10022 -e HOST=&lt;host a&gt; \
            jkawamoto/ambassadors tunnel
</code></pre>

<p>The environment variable <code>HOST</code> is the address for host <em>A</em> and <code>PORT</code> is specified the port number of sshd.
The tunnel-mode container requires a private key of which the related public key <code>id_rsa</code> is included in the <code>authorized_keys</code> put on the server-mode container.
The private key needs to be put in <code>/root/.ssh</code>.
In this example, <code>id_rsa</code> of host <em>B</em> will be used from the tunnel-mode container.</p>

<p>You also need to run client-mode containers for MySQL and MongoDB.</p>

<pre><code class="language-sh">$ docker run -d --name mysql_ambassadors \
             --link ambassadors_tunnel:tunnel --expose 3306 -e PORT=3306 \
             jkawamoto/ambassadors client
$ docker run -d --name mongo_ambassadors \
             --link ambassadors_tunnel:tunnel --expose 27017 -e PORT=27017 \
             jkawamoto/ambassadors client
</code></pre>

<p>Those client-mode containers must link the tunnel-mode container with name <code>tunnel</code> and expose as same port as service containers expose.
In this case, the client-mode container for MySQL exposes <code>3306</code> while the mysql container exposes <code>3306</code>.
Those client-mode containers also need to set environment variable <code>PORT</code> as the exposed port number.</p>

<p>Finally, you can use MySQL and MongoDB running on host <em>A</em> from host <em>B</em>.</p>

<pre><code class="language-sh">$ docker run -d --link mysql_ambassadors:mysql --link mongo_ambassadors:mongo some-app
</code></pre>

<h1 id="license:04c6e90faac2675aa89e2176d2eec7d8">License</h1>

<p>This software is released under the MIT License, see <a href="LICENSE">LICENSE</a>.</p>

              </div>
            </section>
            

            <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
            
            <ins class="adsbygoogle"
                 style="display:block"
                 data-ad-client="ca-pub-4734862314145555"
                 data-ad-slot="7221708629"
                 data-ad-format="auto"></ins>
            <script>
            (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
          </div>
          

          <footer class="footer">
  <div class="pure-menu pure-menu-horizontal pure-menu-open">
    <ul>
      <li>Powered by <a class="hugo" href="https://gohugo.io/" target="_blank">hugo</a></li>
    </ul>
  </div>
</footer>
<script src="js/all.min.js"></script>


<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-57f529147128b1fb"></script>

        </div>
      </div>
    </div>
    
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-82315630-1', 'auto');
ga('send', 'pageview');

</script>

    <div class="remodal" data-remodal-id="wallet">
  <button data-remodal-action="close" class="remodal-close"></button>
  <h1>Bitcoin wallet</h1>
  <p>
    Wallet address:
    <span>1625kBbXoGRWRh92XcgLFik5E6PgV482sm</span>
    <br/>
    <img src="https://chart.googleapis.com/chart?chs=250x250&cht=qr&chl=bitcoin:1625kBbXoGRWRh92XcgLFik5E6PgV482sm"/>
  </p>
  <br/>
  <button data-remodal-action="cancel" class="remodal-cancel">Close</button>
</div>
<script src="js/remodal.min.js"></script>

  </body>
</html>
